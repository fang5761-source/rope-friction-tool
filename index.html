<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>繩索纏繞摩擦力估算（教官工具）</title>
  <style>
    :root{
      --r: 18px;
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent:#2d5bff;
      --warnbg:#fff7ed;
      --warnink:#7a4b00;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 20% -10%, #eef2ff, transparent 55%),
        radial-gradient(900px 500px at 90% 0%, #ecfeff, transparent 55%),
        var(--bg);
      color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
    }
    .wrap{ max-width:820px; margin:0 auto; padding:16px; }
    .card{
      background:var(--card);
      border-radius:var(--r);
      padding:16px;
      box-shadow:0 10px 30px rgba(2,6,23,.08);
      margin:12px 0;
      border:1px solid rgba(226,232,240,.9);
    }
    .head{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    h1{ font-size:18px; margin:0 0 6px; letter-spacing:.2px; }
    .sub{ font-size:13px; color:var(--muted); line-height:1.55; margin:0; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      background:#eef2ff; color:#1e293b; border:1px solid #dbeafe;
      padding:10px 12px; border-radius:999px; font-size:12px; font-weight:800;
      white-space:nowrap;
    }

    .sectionTitle{ font-size:15px; font-weight:950; margin:0 0 10px; }
    label{ display:block; font-size:13px; color:#334155; margin:12px 0 6px; font-weight:800; }
    input, select{
      width:100%;
      font-size:16px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid #d9dbe7;
      outline:none;
      background:#fff;
      line-height:1.35;
    }
    input:focus, select:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 4px rgba(59,130,246,.15);
    }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width:520px){
      .row{ grid-template-columns:1fr; }
    }

    .seg{
      display:grid; grid-template-columns:1fr 1fr; gap:6px;
      background:#f1f5ff;
      border:1px solid #d9dbe7;
      padding:6px;
      border-radius:999px;
    }
    .seg button{
      border-radius:999px;
      padding:10px 12px;
      font-size:13px;
      line-height:1.2;
      border:0;
      background:transparent;
      color:#334155;
      cursor:pointer;
      font-weight:900;
      white-space:normal;
    }
    .seg button.active{
      background:var(--accent);
      color:#fff;
      box-shadow:0 6px 14px rgba(45,91,255,.25);
    }

    .quickRow{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:8px;
      margin-top:10px;
    }
    @media (max-width:520px){
      .quickRow{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    .qbtn{
      padding:12px 10px;
      border-radius:999px;
      border:1px solid #d9dbe7;
      background:#fff;
      color:#0f172a;
      font-weight:950;
      font-size:14px;
      line-height:1.05;
      cursor:pointer;
    }
    .qbtn.soft{ background:#f8fafc; }
    .qbtn:active{ transform: translateY(1px); }

    .btnrow{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:14px; }
    button.primary, button.ghost{
      padding:12px;
      font-size:16px;
      border:0;
      border-radius:16px;
      cursor:pointer;
      font-weight:950;
      line-height:1.2;
    }
    button.primary{
      background:linear-gradient(135deg, #0f172a, #111827);
      color:#fff;
    }
    button.ghost{
      background:#eef2ff;
      color:#1e293b;
      border:1px solid #dbeafe;
    }

    .divider{ height:1px; background:var(--line); margin:14px 0; }

    .kv{
      display:flex; justify-content:space-between; align-items:flex-start;
      padding:12px 0;
      border-bottom:1px dashed var(--line);
      gap:12px;
    }
    .kv:last-child{ border-bottom:0; }
    .k{ font-size:13px; color:#334155; font-weight:850; }
    .v{ text-align:right; }
    .big{ font-size:18px; font-weight:1000; letter-spacing:.2px; }
    .small{ font-size:12px; color:var(--muted); margin-top:3px; line-height:1.35; }

    .badge{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:1000;
      margin-left:8px;
      vertical-align:middle;
      border:1px solid rgba(0,0,0,.06);
    }
    .b-ok{ background:#e9f7ee; color:#1a6b35; }
    .b-mid{ background:#fff5df; color:#7a4b00; }
    .b-high{ background:#ffe8e8; color:#8a1f1f; }

    .hintBox{
      margin-top:12px;
      background:var(--warnbg);
      border-radius:16px;
      padding:12px;
      color:var(--warnink);
      font-size:13px;
      line-height:1.55;
      border:1px solid rgba(251,191,36,.35);
    }
    details{ margin-top:10px; }
    summary{ cursor:pointer; color:#475569; font-size:13px; font-weight:850; }
    .foot{ font-size:12px; color:var(--muted); line-height:1.55; }
    .mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace; }

    .topActions{
      display:flex; gap:8px; flex-wrap:wrap;
      align-items:center; justify-content:flex-end;
    }
    .tinyBtn{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid #d9dbe7;
      background:#fff;
      font-size:12px;
      font-weight:950;
      color:#0f172a;
      cursor:pointer;
      line-height:1.1;
      white-space:nowrap;
    }
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background:rgba(15,23,42,.92);
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
      z-index:9999;
    }
    .toast.show{ opacity:1; }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="card">
      <div class="head">
        <div>
          <h1>繩索纏繞摩擦力估算</h1>
          <p class="sub">
            填入已知 → 直接出答案（結果先顯示 T1/T2，倍率＋顏色作為判斷輔助）<br>
            公式核心：<span class="mono">T₂ = T₁ × e^( μ × θ )</span>（θ = n × 2π）
          </p>
        </div>
        <div class="topActions">
          <span class="pill">手機友善 • 可離線</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="sectionTitle">輸入</div>

      <label>纏繞圈數 n（主輸入）</label>
      <input id="turns" type="number" step="0.01" min="0" value="1.50" inputmode="decimal" />

      <div class="quickRow" aria-label="圈數快鍵">
        <button class="qbtn soft" type="button" data-dn="-0.50">-0.50</button>
        <button class="qbtn soft" type="button" data-dn="-0.25">-0.25</button>
        <button class="qbtn" type="button" data-dn="0.25">+0.25</button>
        <button class="qbtn" type="button" data-dn="0.50">+0.50</button>
        <button class="qbtn soft" type="button" id="nHalf">0.5 圈</button>
        <button class="qbtn soft" type="button" id="nOne">1.0 圈</button>
        <button class="qbtn soft" type="button" id="nTwo">2.0 圈</button>
        <button class="qbtn soft" type="button" id="nZero">0 圈</button>
      </div>

      <label>摩擦條件（情境選擇）</label>
      <select id="preset">
        <option value="0.20">繩索 ↔ 金屬（偏滑）</option>
        <option value="0.25" selected>繩索 ↔ 金屬（一般乾燥）</option>
        <option value="0.35">繩索 ↔ 樹皮（乾）</option>
        <option value="0.45">繩索 ↔ 樹皮（濕/苔/泥）</option>
        <option value="0.40">繩索 ↔ 水泥/混凝土（乾）</option>
        <option value="0.50">繩索 ↔ 水泥/混凝土（濕）</option>
        <option value="0.30">繩索 ↔ 繩索（乾）</option>
        <option value="0.38">繩索 ↔ 繩索（濕）</option>
        <option value="custom">自訂 μ（進階）</option>
      </select>

      <div class="row">
        <div>
          <label>摩擦係數 μ（可微調）</label>
          <input id="mu" type="number" step="0.01" min="0" value="0.25" inputmode="decimal" />
        </div>
        <div>
          <label>已知哪一端？</label>
          <div class="seg" role="tablist" aria-label="已知哪一端">
            <button id="btnT1" class="active" type="button">我知道手端 T1</button>
            <button id="btnT2" type="button">我知道負重端 T2</button>
          </div>
        </div>
      </div>

      <label id="tLabel">已知拉力（T1）</label>
      <div class="row">
        <div>
          <input id="tVal" type="number" step="0.1" min="0" value="20" inputmode="decimal" />
        </div>
        <div>
          <select id="tUnit">
            <option value="kgf" selected>kgf</option>
            <option value="N">N</option>
          </select>
        </div>
      </div>

      <div class="btnrow">
        <button class="primary" id="calc" type="button">計算</button>
        <button class="ghost" id="reset" type="button">重設</button>
      </div>

      <div class="foot" style="margin-top:10px;">
        提醒：μ 受材質、濕度、粉塵、表面粗糙度影響很大；結果用於「快速估算」與「風險判斷提示」。
      </div>
    </div>

    <div class="card">
      <div class="head" style="align-items:center;">
        <div class="sectionTitle" style="margin:0;">結果</div>
        <div class="topActions">
          <button class="tinyBtn" id="copyBtn" type="button">一鍵複製結果</button>
        </div>
      </div>

      <div id="forceBlock">
        <div class="kv">
          <div class="k">手端 T1</div>
          <div class="v">
            <div class="big" id="T1kgf">—</div>
            <div class="small" id="T1N">—</div>
          </div>
        </div>
        <div class="kv">
          <div class="k">負重端 T2</div>
          <div class="v">
            <div class="big" id="T2kgf">—</div>
            <div class="small" id="T2N">—</div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="kv" style="border-bottom:0;">
        <div class="k">摩擦放大倍率 ×M（輔助判斷）</div>
        <div class="v">
          <span class="big" id="mult">—</span>
          <span class="badge b-mid" id="badge">—</span>
          <div class="small" id="thetaInfo">—</div>
        </div>
      </div>

      <div class="foot" id="legend" style="margin-top:10px;">
        倍率等級說明（教學用）：低～中等（<span class="mono">M&lt;3</span>）／偏高（<span class="mono">3≤M&lt;10</span>）／高放大（<span class="mono">10≤M&lt;30</span>）／危險級（<span class="mono">M≥30</span>）
      </div>

      <div class="hintBox" id="hintBox" style="display:none;"></div>

      <details>
        <summary>檢視技術細節（給主授老師/教官查核用）</summary>
        <div class="foot" style="margin-top:8px;">
          θ（弧度）= n × 2π；本次 θ = <span class="mono" id="thetaRad">—</span> rad（≈ <span class="mono" id="thetaTurns">—</span> 圈）<br>
          使用 μ = <span class="mono" id="muUsed">—</span><br>
          公式：<span class="mono">T₂ = T₁ × e^( μ × θ )</span>
        </div>
      </details>
    </div>

  </div>

  <div class="toast" id="toast">已複製</div>

<script>
  const KGF_TO_N = 9.80665;
  const STORE_KEY = "ropeFrictionTool_v2";
  const $ = (id) => document.getElementById(id);
  let knowSide = "T1";

  function toast(msg){
    const t = $("toast");
    t.textContent = msg;
    t.classList.add("show");
    clearTimeout(toast._tm);
    toast._tm = setTimeout(()=>t.classList.remove("show"), 1200);
  }

  function setKnowSide(side){
    knowSide = side;
    $("btnT1").classList.toggle("active", side === "T1");
    $("btnT2").classList.toggle("active", side === "T2");
    $("tLabel").textContent = side === "T1" ? "已知拉力（T1）" : "已知拉力（T2）";
    saveState();
  }

  function fmt(n){
    if (!isFinite(n)) return "—";
    const a = Math.abs(n);
    if (a >= 1000) return n.toFixed(1);
    if (a >= 10) return n.toFixed(2);
    return n.toFixed(3);
  }

  function toN(value, unit){
    if (!isFinite(value) || value < 0) return NaN;
    return unit === "kgf" ? value * KGF_TO_N : value;
  }

  function toKGF(valueN){
    if (!isFinite(valueN)) return NaN;
    return valueN / KGF_TO_N;
  }

  function badgeFor(M){
    if (!isFinite(M) || M <= 0) return { cls:"b-high", text:"輸入異常", hint:"請確認圈數、μ、拉力皆為非負數。"};
    if (M < 3)  return { cls:"b-ok",  text:"低～中等", hint:"倍率在可控區間，但仍需依現場SOP與保護措施操作。"};
    if (M < 10) return { cls:"b-mid", text:"偏高",     hint:"倍率明顯放大：多半圈差很多，注意鎖死/放手控制與護繩。"};
    if (M < 30) return { cls:"b-high",text:"高放大",   hint:"高倍率區：非常容易鎖死與升溫磨耗，建議降低纏繞或改系統配置。"};
    return { cls:"b-high",text:"危險級", hint:"極高倍率：不可預期且極易鎖死/發熱磨耗，建議立即改配置（減圈數/換材質/增加保護）。"};
  }

  function clampTurns(n){
    if (!isFinite(n) || n < 0) return 0;
    return Math.max(0, Math.round(n * 100) / 100);
  }

  function adjustTurns(delta){
    const cur = parseFloat($("turns").value);
    const next = clampTurns((isFinite(cur) ? cur : 0) + delta);
    $("turns").value = next.toFixed(2);
    saveState();
  }

  function setTurns(v){
    $("turns").value = clampTurns(v).toFixed(2);
    saveState();
  }

  function saveState(){
    const state = {
      turns: $("turns").value,
      preset: $("preset").value,
      mu: $("mu").value,
      knowSide,
      tVal: $("tVal").value,
      tUnit: $("tUnit").value
    };
    try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){}
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if (!raw) return false;
      const s = JSON.parse(raw);
      if (s.turns != null) $("turns").value = s.turns;
      if (s.preset != null) $("preset").value = s.preset;
      if (s.mu != null) $("mu").value = s.mu;
      if (s.knowSide) setKnowSide(s.knowSide);
      if (s.tVal != null) $("tVal").value = s.tVal;
      if (s.tUnit) $("tUnit").value = s.tUnit;
      return true;
    }catch(e){ return false; }
  }

  function clearResult(){
    $("T1kgf").textContent = "—";
    $("T1N").textContent = "—";
    $("T2kgf").textContent = "—";
    $("T2N").textContent = "—";
    $("mult").textContent = "—";
    $("badge").className = "badge b-mid";
    $("badge").textContent = "—";
    $("thetaInfo").textContent = "—";
    $("thetaRad").textContent = "—";
    $("thetaTurns").textContent = "—";
    $("muUsed").textContent = "—";
    $("hintBox").style.display = "none";
    $("hintBox").textContent = "";
  }

  function calc(){
    const n = parseFloat($("turns").value);
    const mu = parseFloat($("mu").value);
    const tVal = parseFloat($("tVal").value);
    const unit = $("tUnit").value;

    if (!isFinite(n) || n < 0 || !isFinite(mu) || mu < 0 || !isFinite(tVal) || tVal < 0){
      $("hintBox").style.display = "block";
      $("hintBox").textContent = "⚠ 請確認：圈數 n、μ、拉力皆為非負數。";
      return;
    }

    const theta = n * 2 * Math.PI;
    const M = Math.exp(mu * theta);
    const knownN = toN(tVal, unit);

    let T1N, T2N;
    if (knowSide === "T1"){ T1N = knownN; T2N = T1N * M; }
    else { T2N = knownN; T1N = T2N / M; }

    $("T1kgf").textContent = `${fmt(toKGF(T1N))} kgf`;
    $("T1N").textContent   = `≈ ${fmt(T1N)} N`;
    $("T2kgf").textContent = `${fmt(toKGF(T2N))} kgf`;
    $("T2N").textContent   = `≈ ${fmt(T2N)} N`;

    $("mult").textContent = `× ${fmt(M)}`;
    const b = badgeFor(M);
    $("badge").className = `badge ${b.cls}`;
    $("badge").textContent = b.text;

    $("thetaInfo").textContent = `n=${fmt(n)} 圈（θ≈${fmt(theta)} rad）`;
    $("thetaRad").textContent = fmt(theta);
    $("thetaTurns").textContent = fmt(n);
    $("muUsed").textContent = fmt(mu);

    $("hintBox").style.display = "block";
    $("hintBox").textContent = `⚠ 提醒：${b.hint}`;

    saveState();
  }

  function copyResult(){
    const txt =
`繩索纏繞摩擦力估算
n（圈數）: ${$("turns").value}
摩擦條件: ${$("preset").selectedOptions[0]?.textContent || "-"}
μ: ${$("mu").value}
已知: ${knowSide} = ${$("tVal").value} ${$("tUnit").value}

結果
T1（手端）: ${$("T1kgf").textContent} / ${$("T1N").textContent}
T2（負重端）: ${$("T2kgf").textContent} / ${$("T2N").textContent}
倍率 M: ${$("mult").textContent}（${$("badge").textContent}）
${$("thetaInfo").textContent}`;
    navigator.clipboard?.writeText(txt).then(()=>toast("已複製結果")).catch(()=>{
      const ta = document.createElement("textarea");
      ta.value = txt;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand("copy"); toast("已複製結果"); }catch(e){ toast("複製失敗"); }
      document.body.removeChild(ta);
    });
  }

  function reset(){
    $("turns").value = "1.50";
    $("preset").value = "0.25";
    $("mu").value = "0.25";
    setKnowSide("T1");
    $("tVal").value = "20";
    $("tUnit").value = "kgf";
    clearResult();
    try{ localStorage.removeItem(STORE_KEY); }catch(e){}
    toast("已重設");
  }

  $("btnT1").addEventListener("click", () => setKnowSide("T1"));
  $("btnT2").addEventListener("click", () => setKnowSide("T2"));

  $("preset").addEventListener("change", () => {
    const v = $("preset").value;
    if (v !== "custom") $("mu").value = v;
    saveState();
  });

  document.querySelectorAll("[data-dn]").forEach(btn=>{
    btn.addEventListener("click", ()=>adjustTurns(parseFloat(btn.getAttribute("data-dn"))));
  });
  $("nHalf").addEventListener("click", ()=>setTurns(0.5));
  $("nOne").addEventListener("click", ()=>setTurns(1.0));
  $("nTwo").addEventListener("click", ()=>setTurns(2.0));
  $("nZero").addEventListener("click", ()=>setTurns(0.0));

  $("calc").addEventListener("click", calc);
  $("reset").addEventListener("click", reset);
  $("copyBtn").addEventListener("click", copyResult);

  ["turns","mu","tVal","tUnit"].forEach(id=>{
    $(id).addEventListener("change", saveState);
  });

  ["turns","mu","tVal"].forEach(id=>{
    $(id).addEventListener("keydown", (e)=>{ if(e.key==="Enter") calc(); });
  });

  // init
  loadState();
  clearResult();
</script>
</body>
</html>
